<dom-module id="my-app">
	<template>
	<style include="iron-flex iron-flex-alignment">
		:host {
			display: block;
		}
    .container {
      font-size: 15px;
    }

    .container:hover .input{
      background-color: #5c92e8;
    }
    .container:hover{
      background-color: #5c92e8;
    }
  
    .group {
      width: 200px;
    }

    .input {
      border: none;
    }

    [data-show="open"] {
      display: block;
    }
    [data-show="closed"] {
      display: none;
    }
    .title {
      margin-bottom: 8px;
      margin-left: 8px;
      color: #5c92e8;
    }
	</style>
	<div class="title"> Ethos Folders </div>
	<div class="title"> Engineered by Kyle McGourty </div>

	<div class="file-container">
	 	<template is="dom-repeat" items="{{files}}">
      <div on-click="toggle" style="display:{{item.open}}; background-color:{{item.selected}}" class="container layout horizontal">
        <div class="group layout horizontal" style="margin-left:{{marginComputer(item.level)}}">
            <iron-icon class="fileicon" style="display:{{showFolder(item)}}" icon="icons:folder-open"></iron-icon>
            <iron-icon class="fileicon" style="display:{{showFile(item)}}" icon="av:library-books"></iron-icon>
	 		      <div> <iron-input class="i-input" bind-value="{{item.name}}">
                    <input style="background-color:{{item.selected}}" class ="input" disabled> 
                  </iron-input</div>
            </div>
      </div>
	 	</template>
	</div>
</template>
<script>
 class MyApp extends Polymer.Element {
 	static get is () {
 		return "my-app"

 	}
  static get properties () {

    return {
      storage:{
        type: Array,
        value: function () {
          return []
        }
      }
    }
  }
 	constructor() {
 		super()

 	
 	}

  toggle(e) {

    let ind = e.model.index

    if(this.storage.length == 1){
      let oldindex = this.storage.pop()
      this.set('files.'+oldindex+'.selected', "white")
      this.set('files.'+ind+'.selected', "#7ca8ef")
      this.push('storage', e.model.index)

    } else {
      this.set('files.'+ind+'.selected', "#7ca8ef")
      this.push('storage', e.model.index)
    }
    console.log('e', e)

    let index = e.model.index + 1

    let level = e.model.item.level

    let bool = true

    while (bool) {

      if (this.files[index].level == level || this.files[index].level < level || this.files[index] == undefined) {
        break;
      }

      this.files[index].open == "none" ? this.set('files.'+index+".open", "block"): this.set('files.'+index+".open", "none")


      ++index
    }

    console.log('new files', this.files)

    // let files = this.files

    // this.set('files', [])

    // setTimeout(function(){
    // this.set('files', files)


    // }.bind(this), 500)

  }

  showFolder(item) {


    if (item.children || item.name == "Empty Folder") {
      return "block"
    } else {
      return "none"
    }
  }

  showFile(item) {
    if (item.children || item.name == "Empty Folder") {
      return "none"
    } else {
      return "block"
    }
  }

  marginComputer(level) {

    return level*30 + "px"
  }
 	converter(data) {

   this.files = []

   var leveler = function (collection, level) {
     collection.forEach(function(item, index) {
       item.level = level

       this.push('files', item)
       if (item.children) {
       leveler(item.children, level+1)
       }

     }.bind(this))



   }.bind(this)


   leveler(this.data.children, 1)

   console.log('data after conversion', this.data)

   console.log('files after conversion', this.files)

  }// 

  	ready() {

      super.ready()


 		this.data = {
  "children": [
    {
      "name": "Main Folder",
      "type": "folder",
      "children": [
        {
          "name": "Sub Folder 1",
          "type": "folder",
          "children": [
            {
              "name": "Nested Folder",
              "type": "folder",
              "children": [
                {
                  "name": "Super Nested Folder",
                  "type": "folder",
                  "children": [
                    {
                      "name": "Deep File",
                      "type": "file"
                    },
                    {
                      "name": "Deep File 2",
                      "type": "file"
                    }
                  ]
                }
              ]
            },
            {
              "name": "Empty Folder",
              "type": "folder"
            },
            {
              "name": "Simple Folder",
              "type": "folder",
              "children": [
                {
                  "name": "File",
                  "type": "file"
                }
              ]
            },
            {
              "name": "Empty Folder",
              "type": "folder"
            },
            {
              "name": "Nested File",
              "type": "file"
            }
          ]
        }
      ]
    },
    {
      "name": "Private folder",
      "type": "folder",
      "private": true,
      "children": [
        {
          "name": "Private document",
          "type": "file"
        },
        {
          "name": "Another folder",
          "type": "folder",
          "children" : [
            {
              "name": "Super secret document",
              "type": "file"
            }
          ]
        }
      ]
    },
    {
      "name": "Empty Folder",
      "type": "folder"
    },
    {
      "name": "Empty Folder",
      "type": "folder"
    },
    {
      "name": "Simple Folder",
      "type": "folder",
      "children": [
        {
          "name": "File",
          "type": "file"
        }
      ]
    },
    {
      "name": "Poorly Named Folder",
      "type": "folder",
      "children": [
        {
          "name": "Extremely long file name 3847283948383837472738690283472394256982734982349871203984569872340981234",
          "type": "file"
        }
      ]
    }
  ]
}

	console.log("got the data", this.data)

	this.converter(this.data)

 	}
 }

 customElements.define(MyApp.is, MyApp);
 </script>
 </dom-module>

 